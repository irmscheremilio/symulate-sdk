# Symulate SDK

AI-powered frontend-first development toolkit. Build your frontend without waiting for a backend.

**üìö [Full Documentation](https://symulate.dev/docs)** | **üöÄ [Quick Start](https://symulate.dev/docs/quickstart)** | **üí¨ [Discord Community](https://discord.gg/symulate)**

## Features

- **ü§ñ AI-Powered Mocks** - Realistic data generated by OpenAI with intelligent caching
- **‚ö° Faker.js Mode** - Offline mode for CI/CD pipelines - no AI dependency required
- **üóÑÔ∏è Stateful Collections** - Full CRUD operations with persistent state
- **üîí Type-Safe** - Full TypeScript support with automatic type inference
- **üìä Database Schema Sync** - Reference backend database types directly with `m.db()`
- **üéØ Smart Caching** - In-memory, localStorage, or file-based caching strategies
- **üîÑ Seamless Production Switch** - One config change to switch from mocks to real backend
- **üìù OpenAPI Generation** - Auto-generate API specs for backend developers
- **‚úÖ CI/CD Ready** - Deterministic Faker.js mode with seed support for testing

## Installation

```bash
npm install @symulate/sdk
```

## Quick Start

### 1. Faker Mode (100% Free, No API Key)

Perfect for CI/CD, testing, and basic prototyping.

```typescript
import { defineEndpoint, configureSymulate, m, type Infer } from "@symulate/sdk";

// Configure - no API key needed!
configureSymulate({
  generateMode: "faker",
  environment: "development",
  backendBaseUrl: "https://api.myapp.com",
});

// Define schema
const UserSchema = m.object({
  id: m.uuid(),
  name: m.person.fullName(),
  email: m.email(),
});

// Infer TypeScript type
type User = Infer<typeof UserSchema>;

// Define endpoint
export const getUsers = defineEndpoint<User[]>({
  path: "/api/users",
  method: "GET",
  schema: UserSchema,
  mock: { count: 5 },
});

// Use it
const users = await getUsers(); // Fully typed as User[]
```

### 2. BYOK Mode (Bring Your Own OpenAI Key)

Get AI-powered realistic data with your own OpenAI API key.

```typescript
configureSymulate({
  openaiApiKey: process.env.OPENAI_API_KEY,
  openaiModel: "gpt-4o-mini", // Optional - specify model (default: gpt-4o-mini)
  generateMode: "ai",
  environment: "development",
  backendBaseUrl: "https://api.myapp.com",
});
```

**Supported models:**
- `gpt-4o-mini` (default) - $0.15/$0.60 per 1M tokens
- `gpt-4o` - $2.50/$10.00 per 1M tokens
- `gpt-4-turbo` - $10.00/$30.00 per 1M tokens
- `gpt-4` - $30.00/$60.00 per 1M tokens
- `gpt-3.5-turbo` - $0.50/$1.50 per 1M tokens

### 3. Symulate Platform (Managed Service)

Get cloud hosting, team collaboration, and priority support.

```typescript
configureSymulate({
  symulateApiKey: process.env.SYMULATE_API_KEY,
  projectId: process.env.SYMULATE_PROJECT_ID,
  environment: "development",
  backendBaseUrl: "https://api.myapp.com",
});
```

[Get your API key at platform.symulate.dev](https://platform.symulate.dev)

## Stateful Collections

Define collections with full CRUD operations and persistent state:

```typescript
import { defineCollection, m, type Infer } from '@symulate/sdk';

const ProductSchema = m.object({
  id: m.uuid(),
  name: m.string(),
  price: m.number({ min: 10, max: 1000 }),
  category: m.string(),
  inStock: m.boolean(),
});

export type Product = Infer<typeof ProductSchema>;

export const products = defineCollection<Product>({
  name: "products",
  basePath: "/api/products",
  schema: ProductSchema,
  seedCount: 20,
  seedInstruction: "Generate realistic e-commerce products",
});

// Use it with full CRUD
const { data } = await products.list({ page: 1, limit: 10 });
const newProduct = await products.create({
  name: "New Item",
  price: 29.99,
  category: "Electronics",
  inStock: true
});
await products.update(newProduct.id, { price: 24.99 });
await products.delete(newProduct.id);
```

### Persistence Modes

Configure where collection data is stored:

```typescript
configureSymulate({
  collections: {
    persistence: {
      mode: "memory", // "memory" (default), "local", or "cloud"
      filePath: ".symulate-data.json" // For Node.js file persistence
    }
  }
});
```

- **`memory`** - In-memory only (data lost on refresh) - fastest
- **`local`** - localStorage (browser) or file (Node.js) - persists across reloads
- **`cloud`** - Server-side via Supabase (requires API key) - multi-tenant with branch isolation

## Configuration Options

```typescript
configureSymulate({
  // API Keys (choose one):
  openaiApiKey: string,          // BYOK: Your OpenAI API key
  openaiModel: string,           // BYOK: OpenAI model (default: "gpt-4o-mini")
  symulateApiKey: string,        // Platform API key (sym_live_xxx)

  // Optional:
  projectId: string,             // Project ID (required for platform)
  demoApiKey: string,            // Demo API key (sym_demo_xxx) for pre-generated demos
  backendBaseUrl: string,        // Real backend URL for production
  environment: "development" | "production",  // Default: "development"
  cacheEnabled: boolean,         // Enable caching (default: true)
  persistentCache: boolean,      // Enable localStorage in browser (default: false)
  generateMode: "ai" | "faker" | "auto",  // Default: "auto"
  fakerSeed: number,             // Seed for deterministic Faker.js
  language: string,              // Language for AI-generated data (e.g., "en", "de")
  regenerateOnConfigChange: boolean,  // Regenerate when endpoint config changes (default: true)

  // Collections:
  collections: {
    branch: string,              // Branch name for data isolation
    persistence: {
      mode: "memory" | "local" | "cloud",
      filePath: string,          // File path for Node.js (default: ".symulate-data.json")
    },
  },
});
```

## Schema Builder

### Basic Types

```typescript
const schema = m.object({
  id: m.uuid(),
  text: m.string(),
  count: m.number({ min: 0, max: 100 }),
  active: m.boolean(),
  createdAt: m.date(),
  email: m.email(),
  website: m.url(),
  phone: m.phoneNumber(),
});
```

### Faker.js Fields

```typescript
const person = m.object({
  fullName: m.person.fullName(),
  firstName: m.person.firstName(),
  lastName: m.person.lastName(),
  jobTitle: m.person.jobTitle(),

  userName: m.internet.userName(),
  avatar: m.internet.avatar(),

  street: m.location.street(),
  city: m.location.city(),
  state: m.location.state(),
  zipCode: m.location.zipCode(),
  country: m.location.country(),

  productName: m.commerce.productName(),
  department: m.commerce.department(),
  price: m.commerce.price(),

  word: m.lorem.word(),
  sentence: m.lorem.sentence(),
  paragraph: m.lorem.paragraph(),
});
```

### Nested Objects & Arrays

```typescript
const user = m.object({
  id: m.uuid(),
  name: m.person.fullName(),
  address: m.object({
    street: m.location.street(),
    city: m.location.city(),
  }),
  tags: m.array(m.string()),
});
```

## Mock Configuration

```typescript
mock: {
  count: 10,                    // Generate array of 10 items
  instruction: "Generate premium users with verified accounts",
  delay: 500,                   // Simulate network latency (ms)
  metadata: {                   // Contextual data for AI
    industry: "Technology",
    region: "North America"
  }
}
```

## Parameters

Define typed parameters for your endpoints:

```typescript
const getUserById = defineEndpoint({
  path: "/api/users/:id",
  method: "GET",
  params: [
    {
      name: "id",
      location: "path",          // "path", "query", "header", or "body"
      required: true,
      schema: m.uuid(),
    },
  ],
  schema: UserSchema,
});

// Usage
const user = await getUserById({ id: "123e4567-..." });
```

## CI/CD Example

Use Faker mode for fast, deterministic tests:

```typescript
// jest.setup.ts
import { configureSymulate } from "@symulate/sdk";

configureSymulate({
  generateMode: "faker",
  fakerSeed: 12345,              // Same data every test run
  environment: "development",
});
```

```yaml
# .github/workflows/test.yml
- name: Run tests
  run: npm test
  env:
    NODE_ENV: development
```

## CLI Commands

### Collections Management

```bash
# List all collections
npx symulate collections list

# Delete specific collection
npx symulate collections delete -n products

# Pre-generate all collections
npx symulate collections pregenerate
```

### Cache Management

```bash
# View cached data
npx symulate cache

# Clear all cache
npx symulate regenerate

# Clear specific hash
npx symulate regenerate --hash abc123xyz
```

### OpenAPI Generation

```bash
# Generate OpenAPI spec
npx symulate openapi -o api-spec.json
```

### Database Schema Import

```bash
# Import database schema from platform
npx symulate import-schema

# Import specific schema by name
npx symulate import-schema --schema-name auth
```

## Database Schema Sync

Reference backend database types directly:

```typescript
import type { User, Post } from "./types/database";

const getUser = defineEndpoint<User>({
  path: "/api/users/:id",
  method: "GET",
  schema: m.object({
    id: m.db("users.id"),
    name: m.db("users.name", "German names"),
    email: m.db("users.email"),
    created_at: m.db("users.created_at"),
  }),
});
```

[Learn more about Database Schema Sync](https://symulate.dev/docs/database-schema-sync)

## Tenant Demos

Create isolated demo environments with pre-generated AI data:

```typescript
// Configure SDK with demo API key
configureSymulate({
  demoApiKey: 'sym_demo_your_key_here',
  projectId: 'proj_xxx',
});

// All calls now use pre-generated demo data
const products = await getProducts();       // Pre-generated
const users = await userCollection.list();  // Pre-generated
```

[Learn more about Tenant Demos](https://symulate.dev/docs/tenant-demos)

## Error Handling

Define custom error responses:

```typescript
const getUser = defineEndpoint({
  path: "/api/users/:id",
  method: "GET",
  schema: UserSchema,
  errors: [
    {
      code: 404,
      description: "User not found",
      schema: m.object({
        error: m.object({
          message: m.string(),
          code: m.string(),
        }),
      }),
      failNow: true, // Simulate this error in mock mode
    },
  ],
});
```

## Type Validation

Automatic runtime validation in production mode:

```typescript
import { TypeValidationError } from "@symulate/sdk";

try {
  const users = await getUsers();
} catch (error) {
  if (error instanceof TypeValidationError) {
    console.error("Expected:", error.expected);
    console.error("Received:", error.received);
  }
}
```

## Environment Switching

```bash
# Development (uses mocks)
NODE_ENV=development npm run dev

# Production (uses real backend)
NODE_ENV=production npm run build
```

Or override per-endpoint:

```typescript
export const getNewFeature = defineEndpoint({
  path: "/api/new-feature",
  method: "GET",
  mode: "mock", // Force mock mode even in production
  schema: FeatureSchema,
});
```

## Documentation

- **[Full Documentation](https://symulate.dev/docs)**
- **[Quick Start Guide](https://symulate.dev/docs/quickstart)**
- **[Collections Guide](https://symulate.dev/docs/collections)**
- **[Tenant Demos Guide](https://symulate.dev/docs/tenant-demos)**
- **[CLI Reference](https://symulate.dev/docs/cli)**
- **[Database Schema Sync](https://symulate.dev/docs/database-schema-sync)**

## Community & Support

- **[Discord Community](https://discord.gg/symulate)**
- **[GitHub Discussions](https://github.com/symulate/sdk/discussions)**
- **[GitHub Issues](https://github.com/symulate/sdk/issues)**

## License

MIT License - see [LICENSE](LICENSE) for details
